# DaoyouCode Agent è°ƒç”¨æµç¨‹æ–‡æ¡£

> å®Œæ•´çš„Agentæ‰§è¡Œæµç¨‹ï¼Œä»ç”¨æˆ·è¯·æ±‚åˆ°ç»“æœè¿”å›

**ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-02-12

---

## ä¸€ã€å®Œæ•´æ‰§è¡Œæµç¨‹

### 1.1 æµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»£ç åº“è¯„ä¼°ï¼ˆCodebaseAssessorï¼‰    â”‚
â”‚    - è¯„ä¼°è§„æ¨¡å’Œå¤æ‚åº¦                â”‚
â”‚    - ç”Ÿæˆè¡Œä¸ºæŒ‡å—                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¡Œä¸ºæŒ‡å—ï¼ˆBehaviorGuideï¼‰         â”‚
â”‚    - åˆ†ç±»è¯·æ±‚ç±»å‹                    â”‚
â”‚    - è·å–æœ€ä½³å®è·µ                    â”‚
â”‚    - åˆ¤æ–­æ˜¯å¦éœ€è¦æ¾„æ¸…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©ï¼ˆContextSelectorï¼‰ â”‚
â”‚    - æå–æ–‡ä»¶/å‡½æ•°/ç±»å¼•ç”¨            â”‚
â”‚    - é€‰æ‹©ç›¸å…³æ–‡ä»¶                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ™ºèƒ½è·¯ç”±ï¼ˆIntelligentRouterï¼‰     â”‚
â”‚    - åˆ†æä»»åŠ¡ç‰¹å¾                    â”‚
â”‚    - é€‰æ‹©ç¼–æ’å™¨                      â”‚
â”‚    - é€‰æ‹©Agent                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ™ºèƒ½æ¨¡å‹é€‰æ‹©ï¼ˆModelSelectorï¼‰     â”‚
â”‚    - åˆ†æä»»åŠ¡å¤æ‚åº¦                  â”‚
â”‚    - é€‰æ‹©æœ€ä¼˜æ¨¡å‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ‰§è¡Œè§„åˆ’ï¼ˆExecutionPlannerï¼‰      â”‚
â”‚    - åˆ†æå¤æ‚åº¦                      â”‚
â”‚    - é¢„ä¼°æˆæœ¬å’Œé£é™©                  â”‚
â”‚    - ç”Ÿæˆæ‰§è¡Œè®¡åˆ’                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      ã€ç”¨æˆ·ç¡®è®¤ã€‘â† å¯é€‰
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æƒé™æ£€æŸ¥ï¼ˆPermissionManagerï¼‰     â”‚
â”‚    - æ£€æŸ¥è¯»å–æƒé™                    â”‚
â”‚    - æ£€æŸ¥å†™å…¥æƒé™                    â”‚
â”‚    - æ£€æŸ¥æ‰§è¡Œæƒé™                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      ã€ç”¨æˆ·ç¡®è®¤ã€‘â† å¦‚æœéœ€è¦
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. åˆ›å»ºä»»åŠ¡ï¼ˆTaskManagerï¼‰           â”‚
â”‚    - åˆ›å»ºTaskå¯¹è±¡                    â”‚
â”‚    - è®°å½•ä»»åŠ¡ä¿¡æ¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. åˆ›å»ºä¸Šä¸‹æ–‡ï¼ˆContextManagerï¼‰      â”‚
â”‚    - åˆå§‹åŒ–ä¸Šä¸‹æ–‡                    â”‚
â”‚    - åŠ è½½ç›¸å…³æ–‡ä»¶                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. åŠ è½½è®°å¿†ï¼ˆMemoryManagerï¼‰        â”‚
â”‚     - åŠ è½½å¯¹è¯å†å²                   â”‚
â”‚     - åŠ è½½ç”¨æˆ·åå¥½                   â”‚
â”‚     - åŠ è½½ä»»åŠ¡å†å²                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. ä¼šè¯ç®¡ç†ï¼ˆSessionManagerï¼‰       â”‚
â”‚     - åˆ›å»ºæˆ–æ¢å¤ä¼šè¯                 â”‚
â”‚     - ä¿å­˜ä¼šè¯çŠ¶æ€                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. Hookè§¦å‘ï¼ˆHookManagerï¼‰          â”‚
â”‚     - PRE_EXECUTE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. ç¼–æ’å™¨æ‰§è¡Œï¼ˆOrchestratorï¼‰       â”‚
â”‚     - ä½¿ç”¨Contextä¼ é€’çŠ¶æ€            â”‚
â”‚     - åˆ›å»ºå¿«ç…§ï¼ˆç”¨äºå›æ»šï¼‰           â”‚
â”‚     - æ›´æ–°TaskManager                â”‚
â”‚     - ä½¿ç”¨DelegationManagerå§”æ‰˜      â”‚
â”‚     - ä½¿ç”¨ParallelExecutorå¹¶è¡Œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. Agentæ‰§è¡Œï¼ˆAgentï¼‰               â”‚
â”‚     - ä»Contextè¯»å–å‚æ•°              â”‚
â”‚     - ä½¿ç”¨BehaviorGuideè·å–æŒ‡å¯¼      â”‚
â”‚     - æ‰§è¡Œä»»åŠ¡                       â”‚
â”‚     - ä¿å­˜åˆ°Memory                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 15. Hookè§¦å‘ï¼ˆHookManagerï¼‰          â”‚
â”‚     - POST_EXECUTE                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16. ç‹¬ç«‹éªŒè¯ï¼ˆVerificationManagerï¼‰  â”‚
â”‚     - è¿è¡ŒLSPè¯Šæ–­                    â”‚
â”‚     - è¿è¡Œæ„å»ºå‘½ä»¤                   â”‚
â”‚     - è¿è¡Œæµ‹è¯•å¥—ä»¶                   â”‚
â”‚     - æ£€æŸ¥ä¿®æ”¹çš„æ–‡ä»¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      éªŒè¯é€šè¿‡ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ ç»§ç»­
      â””â”€ å¦ â†’ ReActå¾ªç¯ï¼ˆåæ€é‡è¯•ï¼‰
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 17. åé¦ˆè¯„ä¼°ï¼ˆFeedbackLoopï¼‰         â”‚
â”‚     - è¯„ä¼°ç»“æœè´¨é‡                   â”‚
â”‚     - è¯†åˆ«é—®é¢˜å’Œä¼˜ç‚¹                 â”‚
â”‚     - ç”Ÿæˆæ”¹è¿›å»ºè®®                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18. ä¿å­˜ä¼šè¯ï¼ˆSessionManagerï¼‰       â”‚
â”‚     - ä¿å­˜ä¼šè¯çŠ¶æ€                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 19. æ›´æ–°è®°å¿†ï¼ˆMemoryManagerï¼‰        â”‚
â”‚     - ä¿å­˜å¯¹è¯å†å²                   â”‚
â”‚     - æ›´æ–°ç”¨æˆ·åå¥½                   â”‚
â”‚     - è®°å½•ä»»åŠ¡å†å²                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 20. æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼ˆTaskManagerï¼‰      â”‚
â”‚     - æ ‡è®°ä»»åŠ¡å®Œæˆ                   â”‚
â”‚     - è®°å½•æ‰§è¡Œæ—¶é•¿                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
         è¿”å›ç»“æœ
```

---

## äºŒã€è¯¦ç»†æ­¥éª¤è¯´æ˜

### æ­¥éª¤1ï¼šä»£ç åº“è¯„ä¼°

**ç»„ä»¶**: CodebaseAssessor

**è¾“å…¥**:
- project_root: é¡¹ç›®æ ¹ç›®å½•

**è¾“å‡º**:
- assessment: è¯„ä¼°ç»“æœï¼ˆè§„æ¨¡ã€å¤æ‚åº¦ã€è´¨é‡ï¼‰
- behavior_guide: è¡Œä¸ºæŒ‡å—

**ä»£ç ç¤ºä¾‹**:
```python
assessor = CodebaseAssessor(project_root)
assessment = assessor.assess()
guide = assessor.get_behavior_guide()
```

---

### æ­¥éª¤2ï¼šè¡Œä¸ºæŒ‡å—

**ç»„ä»¶**: BehaviorGuide

**è¾“å…¥**:
- instruction: ç”¨æˆ·æŒ‡ä»¤

**è¾“å‡º**:
- request_type: è¯·æ±‚ç±»å‹ï¼ˆanalyze/edit/test/refactorç­‰ï¼‰
- action_guide: è¡Œä¸ºæŒ‡å¯¼
- should_ask: æ˜¯å¦éœ€è¦æ¾„æ¸…

**ä»£ç ç¤ºä¾‹**:
```python
behavior_guide = BehaviorGuide()
request_type = behavior_guide.classify_request(instruction)
action_guide = behavior_guide.get_action(request_type)
should_ask = behavior_guide.should_ask_clarification(instruction, context_size)
```

---

### æ­¥éª¤3ï¼šæ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©

**ç»„ä»¶**: ContextSelector

**è¾“å…¥**:
- instruction: ç”¨æˆ·æŒ‡ä»¤
- max_files: æœ€å¤§æ–‡ä»¶æ•°

**è¾“å‡º**:
- selected_files: é€‰æ‹©çš„æ–‡ä»¶åˆ—è¡¨

**ä»£ç ç¤ºä¾‹**:
```python
context_selector = ContextSelector(project_root)
selected_files = context_selector.select_context(
    instruction=instruction,
    max_files=10
)
```

---

### æ­¥éª¤4ï¼šæ™ºèƒ½è·¯ç”±

**ç»„ä»¶**: IntelligentRouter

**è¾“å…¥**:
- instruction: ç”¨æˆ·æŒ‡ä»¤

**è¾“å‡º**:
- decision: è·¯ç”±å†³ç­–ï¼ˆç¼–æ’å™¨ã€Agentã€ç½®ä¿¡åº¦ã€ç†ç”±ï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
router = get_intelligent_router()
decision = await router.route(instruction)
# decision.orchestrator: é€‰æ‹©çš„ç¼–æ’å™¨
# decision.agent: é€‰æ‹©çš„Agent
# decision.confidence: ç½®ä¿¡åº¦
# decision.reason: å†³ç­–ç†ç”±
```

---

### æ­¥éª¤5ï¼šæ™ºèƒ½æ¨¡å‹é€‰æ‹©

**ç»„ä»¶**: ModelSelector

**è¾“å…¥**:
- task_type: ä»»åŠ¡ç±»å‹
- context_size: ä¸Šä¸‹æ–‡å¤§å°

**è¾“å‡º**:
- selected_model: é€‰æ‹©çš„æ¨¡å‹

**ä»£ç ç¤ºä¾‹**:
```python
model_selector = ModelSelector()
selected_model = model_selector.select_model(
    task_type="complex",
    context_size=5000
)
```

---

### æ­¥éª¤6ï¼šæ‰§è¡Œè§„åˆ’

**ç»„ä»¶**: ExecutionPlanner

**è¾“å…¥**:
- instruction: ç”¨æˆ·æŒ‡ä»¤

**è¾“å‡º**:
- plan: æ‰§è¡Œè®¡åˆ’ï¼ˆå¤æ‚åº¦ã€æ­¥éª¤ã€æˆæœ¬ã€é£é™©ï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
planner = get_execution_planner()
plan = await planner.create_plan(instruction)
# plan.complexity: å¤æ‚åº¦ï¼ˆ1-5ï¼‰
# plan.steps: æ‰§è¡Œæ­¥éª¤
# plan.total_estimated_tokens: é¢„ä¼°tokens
# plan.total_estimated_time: é¢„ä¼°æ—¶é—´
# plan.risks: é£é™©åˆ—è¡¨
```

---

### æ­¥éª¤7ï¼šæƒé™æ£€æŸ¥

**ç»„ä»¶**: PermissionManager

**è¾“å…¥**:
- category: æƒé™ç±»åˆ«ï¼ˆread/write/delete/executeï¼‰
- path: è·¯å¾„æˆ–å‘½ä»¤

**è¾“å‡º**:
- action: æƒé™åŠ¨ä½œï¼ˆallow/deny/askï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
action = check_permission("write", "config.py")
if action == "deny":
    raise PermissionError("ç¦æ­¢å†™å…¥")
elif action == "ask":
    # è¯¢é—®ç”¨æˆ·
    if not user_confirms():
        raise PermissionError("ç”¨æˆ·æ‹’ç»")
```

---

### æ­¥éª¤8-10ï¼šä»»åŠ¡ã€ä¸Šä¸‹æ–‡ã€è®°å¿†åˆå§‹åŒ–

**ç»„ä»¶**: TaskManager, ContextManager, MemoryManager

**ä»£ç ç¤ºä¾‹**:
```python
# åˆ›å»ºä»»åŠ¡
task = task_manager.create_task(
    name="é‡æ„ä»£ç ",
    agent_name="CodeAnalyzer",
    instruction=instruction
)

# åˆ›å»ºä¸Šä¸‹æ–‡
context = ContextManager()
context.set("files", selected_files)
context.set("model", selected_model)

# åŠ è½½è®°å¿†
memory = memory_manager.load_memory(user_id)
```

---

### æ­¥éª¤11ï¼šä¼šè¯ç®¡ç†

**ç»„ä»¶**: SessionManager

**ä»£ç ç¤ºä¾‹**:
```python
session_manager = SessionManager()
session_id = session_manager.create_session(
    agent_name=decision.agent,
    metadata={
        'instruction': instruction,
        'model': selected_model,
    }
)
```

---

### æ­¥éª¤12ï¼šHookè§¦å‘ï¼ˆPRE_EXECUTEï¼‰

**ç»„ä»¶**: HookManager

**ä»£ç ç¤ºä¾‹**:
```python
hook_manager = get_hook_manager()
await hook_manager.trigger(
    HookEvent.PRE_EXECUTE,
    context={'instruction': instruction}
)
```

---

### æ­¥éª¤13ï¼šç¼–æ’å™¨æ‰§è¡Œ

**ç»„ä»¶**: Orchestratorï¼ˆ7ç§ï¼‰

**ä»£ç ç¤ºä¾‹**:
```python
# æ ¹æ®è·¯ç”±å†³ç­–é€‰æ‹©ç¼–æ’å™¨
orchestrator = get_orchestrator(decision.orchestrator)

# æ‰§è¡Œ
result = await orchestrator.execute(
    skill=skill,
    context=context
)
```

---

### æ­¥éª¤14ï¼šAgentæ‰§è¡Œ

**ç»„ä»¶**: Agent

**ä»£ç ç¤ºä¾‹**:
```python
agent = get_agent(decision.agent)
result = await agent.execute(
    instruction=instruction,
    context=context,
    memory=memory
)
```

---

### æ­¥éª¤15ï¼šHookè§¦å‘ï¼ˆPOST_EXECUTEï¼‰

**ç»„ä»¶**: HookManager

**ä»£ç ç¤ºä¾‹**:
```python
await hook_manager.trigger(
    HookEvent.POST_EXECUTE,
    context={'result': result}
)
```

---

### æ­¥éª¤16ï¼šç‹¬ç«‹éªŒè¯

**ç»„ä»¶**: VerificationManager

**ä»£ç ç¤ºä¾‹**:
```python
verification_manager = get_verification_manager()
verification = await verification_manager.verify(
    result=result,
    level=VerificationLevel.STANDARD,
    modified_files=result.get('modified_files', [])
)

if not verification.passed:
    # éªŒè¯å¤±è´¥ï¼Œè¿›å…¥ReActå¾ªç¯
    # ...
```

---

### æ­¥éª¤17ï¼šåé¦ˆè¯„ä¼°

**ç»„ä»¶**: FeedbackLoop

**ä»£ç ç¤ºä¾‹**:
```python
feedback_loop = get_feedback_loop()
evaluation = await feedback_loop.evaluate(instruction, result)
# evaluation.quality_score: è´¨é‡åˆ†æ•°ï¼ˆ0-1ï¼‰
# evaluation.strengths: ä¼˜ç‚¹åˆ—è¡¨
# evaluation.issues: é—®é¢˜åˆ—è¡¨
# evaluation.suggestions: å»ºè®®åˆ—è¡¨
```

---

### æ­¥éª¤18-20ï¼šä¿å­˜çŠ¶æ€

**ç»„ä»¶**: SessionManager, MemoryManager, TaskManager

**ä»£ç ç¤ºä¾‹**:
```python
# ä¿å­˜ä¼šè¯
session_manager.save_session(session_id)

# æ›´æ–°è®°å¿†
memory_manager.save_memory(user_id, memory)

# æ›´æ–°ä»»åŠ¡çŠ¶æ€
task_manager.update_task(
    task_id=task.id,
    status=TaskStatus.COMPLETED
)
```

---

## ä¸‰ã€ç‰¹æ®Šæµç¨‹

### 3.1 ReActå¾ªç¯ï¼ˆè‡ªæ„ˆæµç¨‹ï¼‰

å½“éªŒè¯å¤±è´¥æ—¶ï¼Œè¿›å…¥ReActå¾ªç¯ï¼š

```
éªŒè¯å¤±è´¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Reflectï¼ˆåæ€ï¼‰                   â”‚
â”‚    - åˆ†æå¤±è´¥åŸå›                     â”‚
â”‚    - ç”Ÿæˆæ–°çš„æŒ‡ä»¤                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Reasonï¼ˆæ¨ç†ï¼‰                    â”‚
â”‚    - é‡æ–°è§„åˆ’                        â”‚
â”‚    - è°ƒæ•´ç­–ç•¥                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Actï¼ˆæ‰§è¡Œï¼‰                       â”‚
â”‚    - é‡æ–°æ‰§è¡Œä»»åŠ¡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Observeï¼ˆè§‚å¯Ÿï¼‰                   â”‚
â”‚    - éªŒè¯ç»“æœ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
      éªŒè¯é€šè¿‡ï¼Ÿ
      â”œâ”€ æ˜¯ â†’ è¿”å›ç»“æœ
      â””â”€ å¦ â†’ ç»§ç»­å¾ªç¯ï¼ˆæœ€å¤šNæ¬¡ï¼‰
```

**ä»£ç ç¤ºä¾‹**:
```python
class ReActOrchestrator(BaseOrchestrator):
    async def execute(self, skill, context, max_reflections=3):
        for attempt in range(max_reflections):
            # Act
            result = await self._execute_task(skill, context)
            
            # Observe
            verification = await self.verify_result(result)
            
            if verification.passed:
                return result
            
            # Reflect
            new_instruction = await self.reflect(
                skill.instruction,
                verification.errors,
                attempt
            )
            
            # Reason
            skill.instruction = new_instruction
        
        return failed_result
```

---

### 3.2 å¹¶è¡Œæ‰§è¡Œæµç¨‹

ä½¿ç”¨ParallelExecutorå¹¶è¡Œæ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼š

```
ä¸»ä»»åŠ¡
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ†è§£å­ä»»åŠ¡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æäº¤å¹¶è¡Œä»»åŠ¡                      â”‚
â”‚    - task1 = executor.submit(...)   â”‚
â”‚    - task2 = executor.submit(...)   â”‚
â”‚    - task3 = executor.submit(...)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç»§ç»­å…¶ä»–å·¥ä½œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è·å–ç»“æœ                          â”‚
â”‚    - result1 = executor.get_result() â”‚
â”‚    - result2 = executor.get_result() â”‚
â”‚    - result3 = executor.get_result() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. èšåˆç»“æœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ç¤ºä¾‹**:
```python
executor = ParallelExecutor(max_workers=4)

# æäº¤ä»»åŠ¡
task_ids = []
for file in files:
    task_id = executor.submit(analyze_file, file)
    task_ids.append(task_id)

# è·å–ç»“æœ
results = []
for task_id in task_ids:
    result = executor.get_result(task_id, timeout=30)
    results.append(result)
```

---

### 3.3 å§”æ‰˜æµç¨‹

ä½¿ç”¨DelegationManagerå§”æ‰˜å­ä»»åŠ¡ï¼š

```
ä¸»ä»»åŠ¡
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆ›å»ºå§”æ‰˜æç¤ºï¼ˆ7æ®µå¼ï¼‰             â”‚
â”‚    - TASK                            â”‚
â”‚    - EXPECTED OUTCOME                â”‚
â”‚    - REQUIRED SKILLS                 â”‚
â”‚    - REQUIRED TOOLS                  â”‚
â”‚    - MUST DO                         â”‚
â”‚    - MUST NOT DO                     â”‚
â”‚    - CONTEXT                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éªŒè¯å§”æ‰˜æç¤º                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å§”æ‰˜ç»™å­Agent                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. éªŒè¯å­Agentç»“æœ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è¿”å›ç»“æœ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»£ç ç¤ºä¾‹**:
```python
delegation_prompt = DelegationPrompt(
    goal="åˆ†æä»£ç è´¨é‡",
    context={"files": files},
    constraints=["åªåˆ†æï¼Œä¸ä¿®æ”¹"],
    expected_output="è´¨é‡æŠ¥å‘Š"
)

# éªŒè¯
is_valid, message = delegation_prompt.validate()

# å§”æ‰˜
if is_valid:
    formatted_prompt = delegation_prompt.to_prompt()
    result = await sub_agent.execute(formatted_prompt)
```

---

## å››ã€ä½¿ç”¨ç¤ºä¾‹

### 4.1 å®Œæ•´ç¤ºä¾‹

```python
async def execute_with_full_workflow(instruction: str):
    """å®Œæ•´çš„æ‰§è¡Œæµç¨‹"""
    
    # 1. ä»£ç åº“è¯„ä¼°
    assessor = CodebaseAssessor(project_root)
    assessment = assessor.assess()
    
    # 2. è¡Œä¸ºæŒ‡å—
    behavior_guide = BehaviorGuide()
    request_type = behavior_guide.classify_request(instruction)
    
    # 3. æ™ºèƒ½ä¸Šä¸‹æ–‡é€‰æ‹©
    context_selector = ContextSelector(project_root)
    files = context_selector.select_context(instruction, max_files=10)
    
    # 4. æ™ºèƒ½è·¯ç”±
    router = get_intelligent_router()
    decision = await router.route(instruction)
    
    # 5. æ™ºèƒ½æ¨¡å‹é€‰æ‹©
    model_selector = ModelSelector()
    model = model_selector.select_model("complex", len(files))
    
    # 6. æ‰§è¡Œè§„åˆ’
    planner = get_execution_planner()
    plan = await planner.create_plan(instruction)
    
    # 7. æƒé™æ£€æŸ¥
    for file in files:
        action = check_permission("write", file)
        if action == "deny":
            raise PermissionError(f"ç¦æ­¢å†™å…¥: {file}")
    
    # 8-10. åˆå§‹åŒ–
    task = task_manager.create_task("ä»»åŠ¡", decision.agent, instruction)
    context = ContextManager()
    memory = memory_manager.load_memory(user_id)
    
    # 11. ä¼šè¯ç®¡ç†
    session_manager = SessionManager()
    session_id = session_manager.create_session(decision.agent)
    
    # 12. Hookè§¦å‘
    await hook_manager.trigger(HookEvent.PRE_EXECUTE, {})
    
    # 13-14. æ‰§è¡Œ
    orchestrator = get_orchestrator(decision.orchestrator)
    result = await orchestrator.execute(skill, context)
    
    # 15. Hookè§¦å‘
    await hook_manager.trigger(HookEvent.POST_EXECUTE, {'result': result})
    
    # 16. ç‹¬ç«‹éªŒè¯
    verification_manager = get_verification_manager()
    verification = await verification_manager.verify(
        result, VerificationLevel.STANDARD
    )
    
    if not verification.passed:
        # ReActå¾ªç¯
        # ...
        pass
    
    # 17. åé¦ˆè¯„ä¼°
    feedback_loop = get_feedback_loop()
    evaluation = await feedback_loop.evaluate(instruction, result)
    
    # 18-20. ä¿å­˜çŠ¶æ€
    session_manager.save_session(session_id)
    memory_manager.save_memory(user_id, memory)
    task_manager.update_task(task.id, TaskStatus.COMPLETED)
    
    return result
```

---

## äº”ã€æ€»ç»“

DaoyouCodeçš„Agentè°ƒç”¨æµç¨‹åŒ…å«20ä¸ªæ­¥éª¤ï¼Œæ¶µç›–äº†ä»ç”¨æˆ·è¯·æ±‚åˆ°ç»“æœè¿”å›çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚

é€šè¿‡18å¤§æ ¸å¿ƒç³»ç»Ÿçš„ååŒå·¥ä½œï¼Œå®ç°äº†ï¼š
- æ™ºèƒ½åŒ–å†³ç­–ï¼ˆè‡ªåŠ¨è·¯ç”±ã€æ¨¡å‹é€‰æ‹©ã€ä¸Šä¸‹æ–‡é€‰æ‹©ï¼‰
- å¯é æ€§ä¿éšœï¼ˆç‹¬ç«‹éªŒè¯ã€ReActå¾ªç¯ï¼‰
- å®‰å…¨æ€§æ§åˆ¶ï¼ˆç»†ç²’åº¦æƒé™ï¼‰
- é«˜æ•ˆæ‰§è¡Œï¼ˆå¹¶è¡Œæ‰§è¡Œã€ä¼šè¯ç®¡ç†ï¼‰
- å®Œæ•´è¿½è¸ªï¼ˆä»»åŠ¡ç®¡ç†ã€è®°å¿†ç³»ç»Ÿï¼‰

è¿™æ˜¯ä¸€ä¸ªçœŸæ­£å®Œç¾çš„Agentæ‰§è¡Œæµç¨‹ï¼ğŸ‰
