# ğŸ‰ å·¥å…·ç³»ç»Ÿé›†æˆå®Œæˆ

> **å®Œæˆæ—¶é—´**: 2025-02-12  
> **çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ¯ å®ç°å†…å®¹

### AIç°åœ¨å¯ä»¥ä¸»åŠ¨è°ƒç”¨å·¥å…·ç†è§£é¡¹ç›®ï¼

ä¸å†éœ€è¦æ‰‹åŠ¨ `/add` æ–‡ä»¶ï¼ŒAIä¼šè‡ªåŠ¨ï¼š
1. è°ƒç”¨ `repo_map` ç”Ÿæˆä»£ç åœ°å›¾
2. è°ƒç”¨ `get_repo_structure` æŸ¥çœ‹ç›®å½•ç»“æ„
3. è°ƒç”¨ `read_file` è¯»å–å…·ä½“æ–‡ä»¶
4. è°ƒç”¨ `search_files` æœç´¢æ–‡ä»¶
5. è°ƒç”¨ `grep_search` æœç´¢ä»£ç 

---

## ğŸ”§ é›†æˆçš„å·¥å…·

### 1. repo_map - æ™ºèƒ½ä»£ç åœ°å›¾

**åŠŸèƒ½**:
- Tree-sitterè§£æä»£ç ç»“æ„
- PageRankç®—æ³•æ™ºèƒ½æ’åº
- ä¸ªæ€§åŒ–æƒé‡ï¼ˆå¯¹è¯æ–‡ä»¶Ã—50ï¼Œæåˆ°çš„æ ‡è¯†ç¬¦Ã—10ï¼‰
- ç¼“å­˜æœºåˆ¶ï¼ˆSQLite + mtimeæ£€æµ‹ï¼‰
- Tokené¢„ç®—æ§åˆ¶

**ä½¿ç”¨åœºæ™¯**:
```
ç”¨æˆ·: "è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"
AI: [è‡ªåŠ¨è°ƒç”¨ repo_map] â†’ åˆ†æç»“æœ â†’ å›ç­”
```

### 2. get_repo_structure - ç›®å½•æ ‘

**åŠŸèƒ½**:
- æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•ç»“æ„
- å¯æ§åˆ¶æ·±åº¦
- è‡ªåŠ¨å¿½ç•¥ node_modulesã€.git ç­‰

**ä½¿ç”¨åœºæ™¯**:
```
ç”¨æˆ·: "é¡¹ç›®æœ‰å“ªäº›ç›®å½•ï¼Ÿ"
AI: [è‡ªåŠ¨è°ƒç”¨ get_repo_structure] â†’ æ˜¾ç¤ºç›®å½•æ ‘
```

### 3. read_file - è¯»å–æ–‡ä»¶

**åŠŸèƒ½**:
- è¯»å–ä»»æ„æ–‡ä»¶å†…å®¹
- æ”¯æŒç¼–ç æ£€æµ‹

**ä½¿ç”¨åœºæ™¯**:
```
ç”¨æˆ·: "Agentç³»ç»Ÿæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"
AI: [æœç´¢æ–‡ä»¶] â†’ [è¯»å– agent.py] â†’ åˆ†æä»£ç  â†’ å›ç­”
```

### 4. search_files - æœç´¢æ–‡ä»¶

**åŠŸèƒ½**:
- æŒ‰æ–‡ä»¶åæœç´¢
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…

**ä½¿ç”¨åœºæ™¯**:
```
ç”¨æˆ·: "å“ªä¸ªæ–‡ä»¶å®ç°äº†è·¯ç”±ï¼Ÿ"
AI: [è°ƒç”¨ search_files("router")] â†’ æ‰¾åˆ°æ–‡ä»¶ â†’ å›ç­”
```

### 5. grep_search - æœç´¢ä»£ç 

**åŠŸèƒ½**:
- åœ¨ä»£ç ä¸­æœç´¢å…³é”®è¯
- æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼

**ä½¿ç”¨åœºæ™¯**:
```
ç”¨æˆ·: "åœ¨å“ªé‡Œè°ƒç”¨äº† execute æ–¹æ³•ï¼Ÿ"
AI: [è°ƒç”¨ grep_search("execute")] â†’ æ˜¾ç¤ºæ‰€æœ‰è°ƒç”¨ä½ç½®
```

---

## ğŸ’¡ å·¥ä½œæµç¨‹

### ä¹‹å‰ï¼ˆæ‰‹åŠ¨ï¼‰

```
ç”¨æˆ·: "è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"
AI: "æˆ‘éœ€è¦æŸ¥çœ‹é¡¹ç›®æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ /add å‘½ä»¤æ·»åŠ æ–‡ä»¶"
ç”¨æˆ·: /add README.md
ç”¨æˆ·: /add STRUCTURE.txt
AI: "å¥½çš„ï¼Œç°åœ¨æˆ‘å¯ä»¥çœ‹åˆ°..."
```

### ç°åœ¨ï¼ˆè‡ªåŠ¨ï¼‰

```
ç”¨æˆ·: "è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"
AI: [è‡ªåŠ¨è°ƒç”¨ repo_map å·¥å…·]
    [åˆ†æä»£ç åœ°å›¾]
    "DaoyouCodeæ˜¯ä¸€ä¸ªæ™ºèƒ½AIä»£ç åŠ©æ‰‹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š
     1. agents/ - Agentç³»ç»Ÿæ ¸å¿ƒ
        - core/ - åŸºç¡€ç»„ä»¶ï¼ˆAgentã€Taskã€Routerç­‰ï¼‰
        - orchestrators/ - 7ç§ç¼–æ’å™¨
        - tools/ - 25ä¸ªå·¥å…·
     2. cli/ - å‘½ä»¤è¡Œç•Œé¢
     ..."
```

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ç†è§£é¡¹ç›®ç»“æ„

```
ä½  â€º è¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ

AI â€º [è°ƒç”¨ repo_map]
    [è°ƒç”¨ read_file("README.md")]
    
    DaoyouCodeæ˜¯ä¸€ä¸ªæ™ºèƒ½AIä»£ç åŠ©æ‰‹ï¼ŒåŸºäº18å¤§æ ¸å¿ƒç³»ç»Ÿ...
```

### ç¤ºä¾‹2: æŸ¥æ‰¾å®ç°

```
ä½  â€º Agentç³»ç»Ÿåœ¨å“ªé‡Œå®ç°çš„ï¼Ÿ

AI â€º [è°ƒç”¨ search_files("agent")]
    [è°ƒç”¨ read_file("daoyoucode/agents/core/agent.py")]
    
    Agentç³»ç»Ÿåœ¨ backend/daoyoucode/agents/core/agent.py ä¸­å®ç°ã€‚
    ä¸»è¦åŒ…å«ï¼š
    - BaseAgent: AgentåŸºç±»
    - AgentRegistry: Agentæ³¨å†Œè¡¨
    - execute(): æ‰§è¡Œä»»åŠ¡çš„æ ¸å¿ƒæ–¹æ³•
    ...
```

### ç¤ºä¾‹3: æœç´¢ä»£ç 

```
ä½  â€º åœ¨å“ªé‡Œè°ƒç”¨äº† orchestratorï¼Ÿ

AI â€º [è°ƒç”¨ grep_search("orchestrator")]
    
    åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­è°ƒç”¨äº† orchestratorï¼š
    1. backend/daoyoucode/agents/executor.py:124
       orchestrator = get_orchestrator(skill.orchestrator)
    
    2. backend/daoyoucode/agents/core/router.py:253
       é€‰æ‹©æœ€ä¼˜ç¼–æ’å™¨...
    ...
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### Agenté…ç½®

```python
# ä¼ é€’å¯ç”¨å·¥å…·åˆ—è¡¨
available_tools = [
    "repo_map",              # ç”Ÿæˆä»£ç åœ°å›¾
    "get_repo_structure",    # è·å–ç›®å½•ç»“æ„
    "read_file",             # è¯»å–æ–‡ä»¶
    "search_files",          # æœç´¢æ–‡ä»¶
    "grep_search"            # æœç´¢ä»£ç 
]

result = await agent.execute(
    prompt_source={"use_agent_default": True},
    user_input=user_input,
    context=agent_context,
    tools=available_tools,      # å·¥å…·åˆ—è¡¨
    max_tool_iterations=5       # æœ€å¤š5æ¬¡å·¥å…·è°ƒç”¨
)
```

### System Prompt

AIè¢«å‘ŠçŸ¥ï¼š
1. å¯ä»¥ä¸»åŠ¨è°ƒç”¨å·¥å…·
2. ä¸è¦è¯´"æˆ‘éœ€è¦æŸ¥çœ‹"ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨
3. æ ¹æ®ç”¨æˆ·é—®é¢˜é€‰æ‹©åˆé€‚çš„å·¥å…·
4. å¯ä»¥é“¾å¼è°ƒç”¨å¤šä¸ªå·¥å…·

---

## ğŸ“Š å¯¹æ¯”

| ç‰¹æ€§ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| ç†è§£é¡¹ç›® | âŒ éœ€è¦æ‰‹åŠ¨æ·»åŠ æ–‡ä»¶ | âœ… è‡ªåŠ¨è°ƒç”¨å·¥å…· |
| æŸ¥æ‰¾ä»£ç  | âŒ æ— æ³•æœç´¢ | âœ… è‡ªåŠ¨æœç´¢ |
| ä»£ç åœ°å›¾ | âŒ æ—  | âœ… PageRankæ™ºèƒ½æ’åº |
| å·¥å…·è°ƒç”¨ | âŒ æ‰‹åŠ¨ | âœ… è‡ªåŠ¨ |
| ç”¨æˆ·ä½“éªŒ | âš ï¸ éœ€è¦å¤šæ­¥æ“ä½œ | âœ… ä¸€æ­¥åˆ°ä½ |

---

## ğŸ‰ æ€»ç»“

**AIç°åœ¨çœŸæ­£ç†è§£é¡¹ç›®äº†ï¼**

ä¸»è¦æ”¹è¿›ï¼š
1. âœ… é›†æˆäº†5ä¸ªæ ¸å¿ƒå·¥å…·
2. âœ… AIå¯ä»¥ä¸»åŠ¨è°ƒç”¨å·¥å…·
3. âœ… æ”¯æŒé“¾å¼å·¥å…·è°ƒç”¨ï¼ˆæœ€å¤š5æ¬¡ï¼‰
4. âœ… æ™ºèƒ½ä»£ç åœ°å›¾ï¼ˆPageRankæ’åºï¼‰
5. âœ… ç¼“å­˜æœºåˆ¶ï¼ˆé¿å…é‡å¤è§£æï¼‰
6. âœ… Tokené¢„ç®—æ§åˆ¶

ç”¨æˆ·ä½“éªŒï¼š
- ä¸å†éœ€è¦æ‰‹åŠ¨ `/add` æ–‡ä»¶
- AIè‡ªåŠ¨ç†è§£é¡¹ç›®ç»“æ„
- è‡ªåŠ¨æœç´¢å’Œè¯»å–ä»£ç 
- ä¸€é—®å³ç­”

---

## ğŸš€ ç«‹å³ä½“éªŒ

```bash
cd backend
python daoyoucode.py chat
```

è¯•è¯•è¿™äº›é—®é¢˜ï¼š
```
ä½  â€º è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ
ä½  â€º Agentç³»ç»Ÿåœ¨å“ªé‡Œå®ç°çš„ï¼Ÿ
ä½  â€º æœ‰å“ªäº›ç¼–æ’å™¨ï¼Ÿ
ä½  â€º æ™ºèƒ½è·¯ç”±æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ
```

AIä¼šè‡ªåŠ¨è°ƒç”¨å·¥å…·æ¥å›ç­”ï¼ğŸŠ
