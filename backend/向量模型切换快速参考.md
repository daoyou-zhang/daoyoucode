# 向量模型切换快速参考

## 当前状态 ✅

```
模式: API
提供商: 智谱AI (zhipu)
模型: embedding-3
维度: 2048
依赖: httpx (不使用huggingface)
```

## 切换到千问（3步）

### 1. 修改配置
```yaml
# config/embedding_config.yaml
mode: "api"
api:
  provider: "qwen"
  api_key: "YOUR_DASHSCOPE_API_KEY"
```

### 2. 删除旧索引
```bash
rm -rf .daoyoucode/codebase_index
```

### 3. 重启系统
```bash
# 重启后自动使用新模型
```

## 三种提供商配置

### 智谱AI（当前）
```yaml
api:
  provider: "zhipu"
  api_key: "f7def1d8285a4b1da14f903a91a330a9.qwwPt8zwziMJIAmY"
```
- 维度: 2048
- 优势: 中文效果好

### 千问
```yaml
api:
  provider: "qwen"
  api_key: "YOUR_DASHSCOPE_API_KEY"
```
- 维度: 1024
- 优势: 阿里云生态，稳定

### OpenAI
```yaml
api:
  provider: "openai"
  api_key: "sk-..."
```
- 维度: 1536
- 优势: 英文最优

## 验证切换

```bash
cd backend
python test_api_mode_verification.py
```

查看输出：
```
✅ 向量检索已启用（API模式）
   提供商: qwen  # 应该显示新的提供商
   模型: text-embedding-v3
   维度: 1024
```

## 常见问题

**Q: 需要重装依赖吗？**
A: 不需要。所有API共享httpx依赖。

**Q: 旧索引还能用吗？**
A: 不能。必须删除重建。

**Q: 可以随时切换回来吗？**
A: 可以。只需改回配置文件。

**Q: API失败会怎样？**
A: 自动回退到关键词匹配。

## 环境变量方式（推荐）

```bash
# Windows CMD
set DASHSCOPE_API_KEY=your_key

# Windows PowerShell
$env:DASHSCOPE_API_KEY="your_key"
```

配置文件：
```yaml
api:
  provider: "qwen"
  # api_key留空，从环境变量读取
```

## 获取API Key

- **智谱AI**: https://open.bigmodel.cn/
- **千问**: https://dashscope.aliyun.com/
- **OpenAI**: https://platform.openai.com/

---

**提示**: 切换模型后记得删除旧索引！
