# âœ… DaoyouCode Agentç³»ç»Ÿ - æœ€ç»ˆçŠ¶æ€æ€»ç»“

> **å®Œæˆæ—¶é—´**: 2025-02-12  
> **çŠ¶æ€**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ‰ å·²å®Œæˆçš„å·¥ä½œ

### 1. æ¶æ„é‡æ„ âœ…

**é—®é¢˜**: CLIç›´æ¥ä¼ é€’å·¥å…·ç»™Agentï¼Œç»•è¿‡äº†Skillç³»ç»Ÿ

**è§£å†³**: 
- å®ç°äº†å®Œæ•´çš„ CLI â†’ Skill â†’ Executor â†’ Orchestrator â†’ Agent â†’ Tools æ¶æ„
- åˆ›å»ºäº† `skills/chat-assistant/` Skillé…ç½®
- ç®€åŒ–äº† `backend/cli/commands/chat.py`ï¼ˆä»200+è¡Œå‡å°‘åˆ°100è¡Œï¼‰

### 2. MainAgentåˆ›å»º âœ…

**æ–‡ä»¶**: `backend/daoyoucode/agents/builtin/main_agent.py`

**ç‰¹ç‚¹**:
- ç®€æ´çš„Agentå®šä¹‰
- Promptç”±Skillç®¡ç†ï¼ˆä¸æ˜¯ç¡¬ç¼–ç ï¼‰
- ä¸å…¶ä»–Agenté£æ ¼ä¸€è‡´

### 3. ReActç¼–æ’å™¨æ³¨å†Œ âœ…

**æ–‡ä»¶**: `backend/daoyoucode/agents/orchestrators/__init__.py`

**ä¿®æ”¹**:
- å¯¼å…¥ `ReActOrchestrator`
- æ³¨å†Œåˆ°ç³»ç»Ÿ

### 4. å·¥å…·ç³»ç»Ÿå®Œå–„ âœ…

**é—®é¢˜**: å·¥å…·æ³¨å†Œè¡¨æ²¡æœ‰è‡ªåŠ¨åˆå§‹åŒ–

**è§£å†³**:
- åœ¨ `backend/daoyoucode/agents/__init__.py` ä¸­è‡ªåŠ¨åˆå§‹åŒ–å·¥å…·æ³¨å†Œè¡¨
- ä¿®å¤äº†å·¥å…·åç§°ä¸åŒ¹é…çš„é—®é¢˜ï¼ˆgrep_search â†’ text_searchï¼‰
- æ·»åŠ äº†å·¥å…·æ‰§è¡Œè¿›åº¦æ˜¾ç¤º

**å·²æ³¨å†Œå·¥å…·**: 25ä¸ª
- æ–‡ä»¶æ“ä½œ: 6ä¸ª
- æœç´¢å·¥å…·: 2ä¸ª
- Gitå·¥å…·: 4ä¸ª
- å‘½ä»¤æ‰§è¡Œ: 2ä¸ª
- Diffå·¥å…·: 1ä¸ª
- RepoMapå·¥å…·: 2ä¸ª
- LSPå·¥å…·: 6ä¸ª
- ASTå·¥å…·: 2ä¸ª

### 5. LLMé…ç½®è‡ªåŠ¨åŠ è½½ âœ…

**æ–‡ä»¶**: `backend/cli/commands/chat.py`

**åŠŸèƒ½**:
- è‡ªåŠ¨åŠ è½½ `backend/config/llm_config.yaml`
- è‡ªåŠ¨æ³¨å†ŒAgent
- è‡ªåŠ¨åˆå§‹åŒ–å·¥å…·æ³¨å†Œè¡¨

### 6. å·¥å…·æ‰§è¡Œè¿›åº¦æ˜¾ç¤º âœ…

**æ–‡ä»¶**: `backend/daoyoucode/agents/core/agent.py`

**åŠŸèƒ½**:
- æ˜¾ç¤ºå·¥å…·åç§°å’Œå‚æ•°
- æ˜¾ç¤ºæ‰§è¡Œè¿›åº¦ï¼ˆâ³ æ­£åœ¨æ‰§è¡Œ...ï¼‰
- æ˜¾ç¤ºæ‰§è¡Œç»“æœï¼ˆâœ“ æˆåŠŸ / âœ— å¤±è´¥ï¼‰

### 7. æ¸…ç†å’Œä¼˜åŒ– âœ…

- åˆ é™¤äº†4ä¸ªç©ºçš„Skillç›®å½•
- ä¿®å¤äº†Skillé…ç½®ä¸­çš„å·¥å…·åç§°
- æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—

---

## ğŸ“Š å½“å‰ç³»ç»ŸçŠ¶æ€

### æ¶æ„æµç¨‹

```
ç”¨æˆ·è¾“å…¥
  â†“
CLI (chat.py)
  â”œâ”€ åŠ è½½LLMé…ç½®
  â”œâ”€ æ³¨å†ŒAgent
  â””â”€ è°ƒç”¨ execute_skill("chat_assistant")
  â†“
Executor (executor.py)
  â”œâ”€ Hookç³»ç»Ÿ (before)
  â”œâ”€ åŠ è½½Skillé…ç½®
  â”œâ”€ è·å–ReActç¼–æ’å™¨
  â”œâ”€ åˆ›å»ºä»»åŠ¡
  â””â”€ æ‰§è¡Œç¼–æ’å™¨
  â†“
ReActç¼–æ’å™¨ (react.py)
  â”œâ”€ åŠ è½½Prompt
  â”œâ”€ è·å–å·¥å…·åˆ—è¡¨
  â””â”€ è°ƒç”¨MainAgent
  â†“
MainAgent (main_agent.py)
  â”œâ”€ ä½¿ç”¨Skillçš„Prompt
  â”œâ”€ è°ƒç”¨LLMï¼ˆå¸¦å·¥å…·ï¼‰
  â””â”€ LLMå†³å®šè°ƒç”¨å“ªäº›å·¥å…·
  â†“
å·¥å…·æ‰§è¡Œ
  â”œâ”€ æ˜¾ç¤ºè¿›åº¦
  â”œâ”€ æ‰§è¡Œå·¥å…·
  â””â”€ è¿”å›ç»“æœ
  â†“
MainAgent
  â””â”€ åŸºäºå·¥å…·ç»“æœç”Ÿæˆå›ç­”
  â†“
ç”¨æˆ·çœ‹åˆ°å›ç­”
```

### å·²æ³¨å†Œçš„Agentï¼ˆ7ä¸ªï¼‰

1. **MainAgent** - ä¸»å¯¹è¯Agent
2. **translator** - ç¿»è¯‘Agent
3. **programmer** - ç¼–ç¨‹Agent
4. **code_analyzer** - ä»£ç åˆ†æAgent
5. **code_explorer** - ä»£ç æ¢ç´¢Agent
6. **refactor_master** - é‡æ„Agent
7. **test_expert** - æµ‹è¯•Agent

### å·²åŠ è½½çš„Skillï¼ˆ7ä¸ªï¼‰

1. **chat_assistant** - äº¤äº’å¼å¯¹è¯ï¼ˆä½¿ç”¨ReActç¼–æ’å™¨ï¼‰
2. **code-analysis** - ä»£ç æ¶æ„åˆ†æ
3. **code-exploration** - ä»£ç åº“æœç´¢
4. **programming** - ç¼–ç¨‹ä¸“å®¶
5. **refactoring** - ä»£ç é‡æ„
6. **testing** - æµ‹è¯•ç¼–å†™
7. **translation** - ä¸“ä¸šç¿»è¯‘

### å¯ç”¨å·¥å…·ï¼ˆ25ä¸ªï¼‰

è¯¦è§ `backend/test_tool_registry.py` è¾“å‡º

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•1: å·¥å…·æ³¨å†Œ
```bash
python backend/test_tool_registry.py
```
**ç»“æœ**: âœ… 25ä¸ªå·¥å…·å…¨éƒ¨æ³¨å†ŒæˆåŠŸ

### æµ‹è¯•2: LLMé…ç½®
```bash
python backend/test_llm_config.py
```
**ç»“æœ**: âœ… é€šä¹‰åƒé—®é…ç½®åŠ è½½æˆåŠŸ

### æµ‹è¯•3: å®Œæ•´æµç¨‹
```bash
python backend/test_chat_flow.py
```
**ç»“æœ**: âœ… Agentç³»ç»Ÿæ­£å¸¸å·¥ä½œ

### æµ‹è¯•4: å·¥å…·è¯Šæ–­
```bash
python backend/diagnose_tools.py
```
**ç»“æœ**: âœ… å·¥å…·æ³¨å†Œè¡¨å•ä¾‹æ­£å¸¸

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¯åŠ¨äº¤äº’å¼å¯¹è¯

```bash
cd backend
python -m cli.app chat
```

### æµ‹è¯•åœºæ™¯

#### åœºæ™¯1: é¡¹ç›®ç»“æ„åˆ†æ
```
ä½  â€º è¿™ä¸ªé¡¹ç›®çš„ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ
```

**é¢„æœŸè¾“å‡º**:
```
ğŸ”§ æ‰§è¡Œå·¥å…·: repo_map
   å‚æ•°: {'repo_path': '.'}
   â³ æ­£åœ¨æ‰§è¡Œ...
   âœ“ æ‰§è¡Œå®Œæˆ

AI â€º DaoyouCodeæ˜¯ä¸€ä¸ªæ™ºèƒ½AIä»£ç åŠ©æ‰‹ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ¨¡å—ï¼š
1. backend/daoyoucode/agents/ - Agentç³»ç»Ÿæ ¸å¿ƒ
2. backend/cli/ - å‘½ä»¤è¡Œç•Œé¢
3. skills/ - Skillé…ç½®
...
```

#### åœºæ™¯2: æ–‡ä»¶æŸ¥çœ‹
```
ä½  â€º backend/cli/commands/chat.pyåšä»€ä¹ˆçš„ï¼Ÿ
```

**é¢„æœŸ**: Agentè°ƒç”¨ `read_file` å·¥å…·

#### åœºæ™¯3: ä»£ç æœç´¢
```
ä½  â€º execute_skillå‡½æ•°åœ¨å“ªé‡Œå®ç°çš„ï¼Ÿ
```

**é¢„æœŸ**: Agentè°ƒç”¨ `text_search` å·¥å…·

#### åœºæ™¯4: å¯¹æ¯”åˆ†æ
```
ä½  â€º å¯¹æ¯”opencodeã€oh-my-opencodeï¼Œæˆ‘ä»¬DaoyouCodeçš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ
```

**é¢„æœŸ**: Agentè°ƒç”¨å¤šä¸ªå·¥å…·è¿›è¡Œåˆ†æ

---

## ğŸ“ å…³é”®æ–‡ä»¶

### æ ¸å¿ƒå®ç°

1. **Skillé…ç½®**
   - `skills/chat-assistant/skill.yaml` - Skillå®šä¹‰
   - `skills/chat-assistant/prompts/chat_assistant.md` - Promptæ¨¡æ¿

2. **CLIå‘½ä»¤**
   - `backend/cli/commands/chat.py` - ç®€åŒ–åçš„chatå‘½ä»¤

3. **Agentç³»ç»Ÿ**
   - `backend/daoyoucode/agents/builtin/main_agent.py` - MainAgent
   - `backend/daoyoucode/agents/core/agent.py` - AgentåŸºç±»
   - `backend/daoyoucode/agents/executor.py` - Skillæ‰§è¡Œå™¨

4. **ç¼–æ’å™¨**
   - `backend/daoyoucode/agents/orchestrators/react.py` - ReActç¼–æ’å™¨
   - `backend/daoyoucode/agents/orchestrators/__init__.py` - ç¼–æ’å™¨æ³¨å†Œ

5. **å·¥å…·ç³»ç»Ÿ**
   - `backend/daoyoucode/agents/tools/registry.py` - å·¥å…·æ³¨å†Œè¡¨
   - `backend/daoyoucode/agents/tools/repomap_tools.py` - RepoMapå·¥å…·
   - `backend/daoyoucode/agents/tools/search_tools.py` - æœç´¢å·¥å…·
   - `backend/daoyoucode/agents/tools/file_tools.py` - æ–‡ä»¶å·¥å…·

### é…ç½®æ–‡ä»¶

1. `backend/config/llm_config.yaml` - LLMé…ç½®
2. `backend/config/agent_router_config.yaml` - Agentè·¯ç”±é…ç½®

### æµ‹è¯•è„šæœ¬

1. `backend/test_tool_registry.py` - å·¥å…·æ³¨å†Œæµ‹è¯•
2. `backend/test_chat_flow.py` - å®Œæ•´æµç¨‹æµ‹è¯•
3. `backend/test_llm_config.py` - LLMé…ç½®æµ‹è¯•
4. `backend/diagnose_tools.py` - å·¥å…·è¯Šæ–­

### æ–‡æ¡£

1. `backend/CORRECT_ARCHITECTURE.md` - æ­£ç¡®æ¶æ„è¯´æ˜
2. `backend/ARCHITECTURE_FIXED.md` - æ¶æ„ä¿®å¤è¯¦æƒ…
3. `backend/å·¥å…·ç³»ç»Ÿå·²å°±ç»ª.md` - å·¥å…·ç³»ç»ŸçŠ¶æ€
4. `backend/å·¥å…·åç§°å·²ä¿®å¤.md` - å·¥å…·åç§°ä¿®å¤
5. `backend/å·¥å…·æ‰§è¡Œè¿›åº¦å·²æ·»åŠ .md` - è¿›åº¦æ˜¾ç¤ºè¯´æ˜
6. `backend/æœ€ç»ˆçŠ¶æ€æ€»ç»“.md` - æœ¬æ–‡æ¡£

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. Skillé©±åŠ¨

æ‰€æœ‰è¡Œä¸ºåœ¨Skillé…ç½®ä¸­å®šä¹‰ï¼š
- ä½¿ç”¨å“ªä¸ªç¼–æ’å™¨
- ä½¿ç”¨å“ªä¸ªAgent
- æœ‰å“ªäº›å·¥å…·
- æƒé™æ§åˆ¶
- Hooké…ç½®

### 2. Agentè‡ªä¸»æ€§

Agentä¼šä¸»åŠ¨è°ƒç”¨å·¥å…·ï¼š
- ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ `/add` æ–‡ä»¶
- è‡ªåŠ¨åˆ†æé¡¹ç›®ç»“æ„
- æ™ºèƒ½é€‰æ‹©åˆé€‚çš„å·¥å…·

### 3. å®Œæ•´çš„å·¥å…·ç³»ç»Ÿ

25ä¸ªä¸“ä¸šå·¥å…·ï¼š
- æ–‡ä»¶æ“ä½œ
- ä»£ç æœç´¢
- Gitæ“ä½œ
- LSPé›†æˆ
- ASTåˆ†æ

### 4. å¯è§‚æµ‹æ€§

- å·¥å…·æ‰§è¡Œè¿›åº¦æ˜¾ç¤º
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- ä»»åŠ¡ç®¡ç†
- Hookç³»ç»Ÿ

---

## ğŸ› å·²ä¿®å¤çš„Bug

1. âœ… CLIç›´æ¥ä¼ é€’å·¥å…·ï¼ˆæ¶æ„é—®é¢˜ï¼‰
2. âœ… ReActç¼–æ’å™¨æœªæ³¨å†Œ
3. âœ… MainAgentä¸å­˜åœ¨
4. âœ… å·¥å…·æ³¨å†Œè¡¨æœªåˆå§‹åŒ–
5. âœ… å·¥å…·åç§°ä¸åŒ¹é…ï¼ˆgrep_search â†’ text_searchï¼‰
6. âœ… ç©ºSkillç›®å½•è­¦å‘Š
7. âœ… LLMé…ç½®æœªåŠ è½½
8. âœ… å·¥å…·æ‰§è¡Œæ— è¿›åº¦æ˜¾ç¤º

---

## ğŸ“ˆ å¯¹æ¯”å…¶ä»–é¡¹ç›®

### vs opencode

**DaoyouCodeä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„Skillç³»ç»Ÿ
- âœ… 7ç§ç¼–æ’å™¨ï¼ˆopencodeåªæœ‰ç®€å•æ‰§è¡Œï¼‰
- âœ… 25ä¸ªä¸“ä¸šå·¥å…·
- âœ… æƒé™æ§åˆ¶å’ŒéªŒè¯
- âœ… Hookç³»ç»Ÿ
- âœ… ä»»åŠ¡ç®¡ç†

### vs oh-my-opencode

**DaoyouCodeä¼˜åŠ¿**:
- âœ… æ›´å¥½çš„æ¶æ„ï¼ˆSkillé©±åŠ¨ï¼‰
- âœ… æ›´å¤šçš„Agentï¼ˆ7ä¸ª vs 3ä¸ªï¼‰
- âœ… æ›´å¼ºçš„å·¥å…·ç³»ç»Ÿï¼ˆ25ä¸ª vs 10ä¸ªï¼‰
- âœ… å®Œæ•´çš„CLIï¼ˆ10ä¸ªå‘½ä»¤ï¼‰
- âœ… è®°å¿†ç³»ç»Ÿé›†æˆ

---

## ğŸ‰ æ€»ç»“

DaoyouCode Agentç³»ç»Ÿå·²ç»å®Œå…¨å°±ç»ªï¼

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å®Œæ•´çš„Skillç³»ç»Ÿ
- âœ… æ™ºèƒ½ç¼–æ’å™¨ï¼ˆReActï¼‰
- âœ… 25ä¸ªä¸“ä¸šå·¥å…·
- âœ… 7ä¸ªä¸“ä¸šAgent
- âœ… æƒé™æ§åˆ¶
- âœ… Hookç³»ç»Ÿ
- âœ… ä»»åŠ¡ç®¡ç†
- âœ… Agentè‡ªä¸»æ€§
- âœ… å·¥å…·è‡ªåŠ¨è°ƒç”¨

**æµ‹è¯•çŠ¶æ€**:
- âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- âœ… é›†æˆæµ‹è¯•é€šè¿‡
- âœ… çœŸå®APIæµ‹è¯•é€šè¿‡

**å¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼** ğŸš€

```bash
cd backend
python -m cli.app chat
```

ç„¶åè¾“å…¥ä½ çš„é—®é¢˜ï¼ŒAgentä¼šä¸»åŠ¨è°ƒç”¨å·¥å…·æ¥ç†è§£é¡¹ç›®å¹¶å›ç­”ï¼
