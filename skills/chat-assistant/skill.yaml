# 名称与 CLI 默认 --skill chat-assistant 对齐，避免找不到 Skill
name: chat-assistant
version: 1.0.0
description: 交互式对话助手，支持代码理解、编写和项目分析

orchestrator: react
agent: MainAgent

# Prompt配置
prompt:
  file: prompts/chat_assistant.md  # 改进版本（结合 DaoyouCode 和 Oh-My-OpenCode 最佳实践）

# 「了解项目」预取：用 LLM 判断意图（如「我想知道架构」也会触发），不再依赖写死触发词
project_understanding_use_intent: true
# 当 project_understanding_use_intent 为 false 时生效的触发词（可选兜底）
project_understanding_triggers:
  - 了解
  - 看看项目
  - 项目怎么样
  - 项目是啥
  - 介绍项目
  - 这是什么项目
  - 说说项目
  - 项目结构

# 可选：预取块总字符上限（不设则默认约 16000）。若模型上下文很小可设小值（如 8000）避免超窗
# project_understanding_max_chars: 16000

# LLM配置（max_tokens 为回复长度上限；输入上下文由模型窗口决定，ReAct 不经过 ContextManager 的 token_budget 剪枝）
llm:
  model: qwen-max
  temperature: 0.7
  max_tokens: 4000

# 可用工具（ReAct编排器会自动管理；「了解项目」必须用三层：discover_project_docs → get_repo_structure → repo_map）
tools:
  - discover_project_docs # 项目文档（README 等），了解项目先调
  - get_repo_structure    # 目录树
  - repo_map              # 代码地图
  - semantic_code_search  # 按问题语义检索相关代码（Cursor 同级）
  - read_file             # 读取文件
  - text_search           # 文本搜索（修正：原来是grep_search）
  - regex_search          # 正则搜索
  - write_file            # 写入文件（如果需要）
  - list_files            # 列出目录（修正：原来是list_directory）

# 中间件
middleware:
  - context_management
  - memory_integration

# 权限（读写权限）
permissions:
  read:
    - pattern: "*"
      permission: allow
  write:
    - pattern: "*.py"
      permission: allow
    - pattern: "*.js"
      permission: allow
    - pattern: "*.ts"
      permission: allow
    - pattern: "*.md"
      permission: allow
  execute:
    - pattern: "*"
      permission: deny

# 输入
inputs:
  - name: user_input
    type: string
    required: true
    description: 用户输入的问题或指令
  
  - name: session_id
    type: string
    required: false
    description: 会话ID
  
  - name: initial_files
    type: array
    required: false
    description: 打开的编辑器文件列表（优先使用）
  
  - name: repo
    type: string
    required: false
    description: 仓库路径

# 输出
outputs:
  - name: response
    type: string
    description: AI的响应内容
  
  - name: tools_used
    type: array
    description: 使用的工具列表
  
  - name: reasoning
    type: string
    description: 推理过程

# Hook配置
hooks:
  - logging
  - metrics
  - memory_save

# 元数据
metadata:
  category: assistant
  cost: MEDIUM
  triggers:
    - "对话"
    - "提问"
    - "代码编写"
    - "项目分析"
  use_when:
    - "用户交互"
    - "代码理解"
    - "项目探索"
  features:
    - "自动工具调用"
    - "推理循环"
    - "记忆集成"
    - "上下文管理"
