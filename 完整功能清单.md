# daoyoucode 完整功能清单

> **设计原则**: 吸收三个项目的所有优点，去重后选择最佳实现  
> **来源**: daoyouCodePilot + oh-my-opencode + OpenCode

---

## 📋 目录

1. [核心编辑功能](#核心编辑功能)
2. [多智能体系统](#多智能体系统)
3. [工具集成](#工具集成)
4. [自动化功能](#自动化功能)
5. [用户界面](#用户界面)
6. [扩展系统](#扩展系统)
7. [LLM集成](#llm集成)
8. [存储与缓存](#存储与缓存)
9. [团队协作](#团队协作)
10. [性能优化](#性能优化)

---

## 1. 核心编辑功能

### 1.1 编辑模式 (8种)

**来源**: daoyouCodePilot ✅ 最完整

| 模式 | 说明 | 适用场景 |
|------|------|---------|
| **EditBlock** | 块级精准编辑 | 小范围修改 |
| **WholeFile** | 全文件重写 | 大规模重构 |
| **UnifiedDiff** | 标准diff格式 | 兼容性强 |
| **Patch** | 结构化补丁 | 复杂修改 |
| **Ask** | 问答模式 | 不修改代码 |
| **Architect** | 架构分析 | 代码结构分析 |
| **Search** | 搜索模式 | 代码查找 |
| **Help** | 帮助模式 | 获取建议 |

**实现**: Python，支持智能模式选择



### 1.2 Diff系统

**来源**: 三者都有，选择 oh-my-opencode 的增强版 ✅

- **模糊匹配**: 容忍文件微小变化
- **结构化异常**: 可操作的错误类型
- **智能应用**: 自动寻找最佳应用位置
- **预览系统**: 语法高亮的diff预览
- **交互确认**: 用户友好的确认界面

**实现**: Python + Rich库美化输出

### 1.3 代码解析

**来源**: 三者都有，选择最强组合 ✅

- **Tree-sitter**: 代码结构解析 (from daoyou)
- **AST-Grep**: AST级搜索替换 (from oh-my-opencode)
- **LSP**: 语义分析 (from oh-my-opencode)

**实现**: Python绑定 + 独立插件

---

## 2. 多智能体系统

### 2.1 核心智能体

**来源**: oh-my-opencode ✅ 最完整的智能体系统

| 智能体 | 模型 | 职责 | 特点 |
|--------|------|------|------|
| **Sisyphus** | Claude Opus 4.5 | 主编排器 | Todo驱动，持续执行 |
| **Oracle** | GPT 5.2 | 架构顾问 | 只读，高IQ分析 |
| **Librarian** | GLM 4.7 | 文档专家 | 多仓库分析，证据驱动 |
| **Explore** | Grok Code | 快速探索 | 上下文grep，快速搜索 |
| **Multimodal** | Gemini 3 Flash | 视觉分析 | PDF/图像分析 |
| **Prometheus** | Claude Opus 4.5 | 战略规划 | 访谈模式，详细计划 |
| **Metis** | Claude Sonnet 4.5 | 计划顾问 | 预规划分析 |
| **Momus** | Claude Sonnet 4.5 | 计划审查 | 验证计划完整性 |

**新增智能体** (基于中文优化):

| 智能体 | 模型 | 职责 |
|--------|------|------|
| **ChineseEditor** | Qwen Coder Plus | 中文编辑专家 |
| **RefactorMaster** | Claude Opus 4.5 | 重构专家 |
| **TestExpert** | DeepSeek Coder | 测试专家 |
| **FrontendExpert** | Gemini 3 Pro | 前端专家 |
| **BackendExpert** | Qwen Max | 后端专家 |

**实现**: Python，每个智能体独立模块

### 2.2 智能体协作

**来源**: oh-my-opencode ✅

- **并行执行**: 多个智能体同时工作
- **后台任务**: 不阻塞主流程
- **任务委托**: delegate_task工具
- **结果聚合**: 自动合并结果
- **并发控制**: 按提供商/模型限制并发

**实现**: Python asyncio + 任务队列

### 2.3 智能体权限

**来源**: oh-my-opencode ✅

```python
permissions = {
    "edit": "ask" | "allow" | "deny",
    "bash": "ask" | "allow" | "deny" | {"git": "allow", "rm": "deny"},
    "webfetch": "ask" | "allow" | "deny",
    "doom_loop": "ask" | "allow" | "deny",
    "external_directory": "ask" | "allow" | "deny"
}
```

**实现**: Python，配置驱动

---

## 3. 工具集成

### 3.1 LSP工具

**来源**: oh-my-opencode ✅ 最完整

| 工具 | 功能 |
|------|------|
| **lsp_diagnostics** | 获取错误/警告 |
| **lsp_rename** | 跨工作区重命名 |
| **lsp_goto_definition** | 跳转定义 |
| **lsp_find_references** | 查找引用 |
| **lsp_symbols** | 符号搜索 |
| **lsp_code_actions** | 代码操作 |

**实现**: Python + LSP服务器集成

### 3.2 AST工具

**来源**: oh-my-opencode ✅

- **ast_grep_search**: AST级搜索 (25种语言)
- **ast_grep_replace**: AST级替换

**实现**: Python + ast-grep绑定

### 3.3 Git工具

**来源**: daoyouCodePilot + oh-my-opencode，融合最佳 ✅

**基础功能** (from daoyou):
- 自动提交
- 智能commit message
- 代码归因
- Git状态查询
- Git diff

**高级功能** (from oh-my-opencode git-master):
- **原子提交**: 自动拆分多个提交
- **Rebase/Squash**: 历史重写
- **历史考古**: blame, bisect, log -S
- **风格检测**: 自动匹配仓库commit风格

**实现**: Python + GitPython

### 3.4 文件操作工具

**来源**: daoyouCodePilot ✅ 最完整

- `read_file`: 读取文件
- `write_file`: 写入文件（自动创建目录）
- `list_files`: 列出目录（递归+模式匹配）
- `get_file_info`: 文件信息
- `create_directory`: 创建目录
- `delete_file`: 删除文件/目录

**实现**: Python标准库

### 3.5 代码搜索工具

**来源**: 三者融合 ✅

- **文本搜索**: ripgrep (from oh-my-opencode)
- **正则搜索**: Python re (from daoyou)
- **AST搜索**: ast-grep (from oh-my-opencode)
- **语义搜索**: LSP symbols (from oh-my-opencode)

**实现**: Python + 多种搜索引擎

### 3.6 测试工具

**来源**: daoyouCodePilot ✅

- `run_test`: 运行测试
- 自动测试失败修复
- 测试结果分析

**实现**: Python + pytest/unittest

### 3.7 命令执行工具

**来源**: daoyouCodePilot + oh-my-opencode 融合 ✅

**基础** (from daoyou):
- `run_command`: 执行shell命令

**增强** (from oh-my-opencode):
- 用户审批
- 流式输出
- 结构化错误解析
- 交互式bash会话 (tmux)

**实现**: Python subprocess + tmux

### 3.8 浏览器自动化

**来源**: oh-my-opencode playwright skill ✅

- 网页导航
- 截图/PDF
- 表单填写
- 内容抓取

**实现**: Python + Playwright

---

## 4. 自动化功能

### 4.1 智能上下文管理

**来源**: 三者融合 ✅

**自动添加文件** (from daoyou):
- 识别指令中的文件路径
- 搜索包含函数名的文件
- 过滤大文件

**上下文注入** (from oh-my-opencode):
- 自动注入AGENTS.md
- 自动注入README.md
- 条件规则注入

**上下文压缩** (from oh-my-opencode):
- 智能总结
- 动态截断
- 保留关键信息

**实现**: Python，智能分析

### 4.2 智能模型选择

**来源**: daoyouCodePilot + oh-my-opencode 融合 ✅

**策略**:
```python
if task.language == "zh-CN" and task.complexity == "simple":
    model = "qwen-coder-plus"  # 便宜快速
elif task.type == "architecture":
    model = "gpt-5.2"  # 高IQ
elif task.type == "refactor":
    model = "claude-opus-4-5"  # 重构专家
elif task.type == "frontend":
    model = "gemini-3-pro"  # 前端专家
else:
    model = "qwen-max"  # 默认
```

**实现**: Python，规则引擎

### 4.3 自动修复机制

**来源**: daoyouCodePilot + oh-my-opencode 融合 ✅

- 编辑失败自动重试 (最多3次)
- 测试失败自动修复
- 错误恢复和回滚
- 反思-修正循环

**实现**: Python，异常处理

### 4.4 Todo持续执行

**来源**: oh-my-opencode ✅ 独特功能

- 强制完成任务
- 检测`<promise>DONE</promise>`
- 自动继续未完成任务
- Ralph Loop自引用循环

**实现**: Python，状态机

### 4.5 文件监控

**来源**: daoyouCodePilot ✅

- 监控文件变更
- 检测AI注释 (`# ai!`, `# ai?`)
- 自动触发编辑
- Gitignore支持

**实现**: Python watchdog



---

## 5. 用户界面

### 5.1 CLI (命令行)

**来源**: daoyouCodePilot + OpenCode 融合 ✅

**命令**:
```bash
daoyoucode edit <files> <prompt>      # 编辑文件
daoyoucode chat                       # 交互式对话
daoyoucode config                     # 配置管理
daoyoucode agent <name>               # 调用特定智能体
daoyoucode plugin list                # 插件管理
daoyoucode skill list                 # Skill管理
```

**实现**: Python Click

### 5.2 TUI (终端UI)

**来源**: OpenCode + oh-my-opencode 融合 ✅

- 美观的终端界面
- 实时进度显示
- 交互式对话
- 代码高亮
- Diff预览

**实现**: React Ink

### 5.3 Web界面

**来源**: daoyouCodePilot (Streamlit) → 升级为 React ✅

- 可视化配置
- 历史记录查看
- 实时对话
- 代码编辑器集成
- 团队协作

**实现**: React + Vite

### 5.4 桌面应用

**来源**: OpenCode ✅

- 跨平台 (Windows/macOS/Linux)
- 原生体验
- 系统集成
- 离线可用

**实现**: Electron + React

### 5.5 IDE插件

**来源**: 新增功能 ✅

- VS Code插件
- JetBrains插件
- Vim/Neovim插件

**实现**: 各IDE的插件API

---

## 6. 扩展系统

### 6.1 Hook系统

**来源**: oh-my-opencode ✅ 最完整 (25+ Hooks)

**Hook事件**:
- PreToolUse: 工具执行前
- PostToolUse: 工具执行后
- UserPromptSubmit: 用户提交提示词
- Stop: 会话空闲

**内置Hooks分类**:

**上下文注入**:
- directory-agents-injector
- directory-readme-injector
- rules-injector
- compaction-context-injector

**生产力控制**:
- keyword-detector (ultrawork, search, analyze)
- think-mode
- ralph-loop
- start-work
- auto-slash-command

**质量安全**:
- comment-checker
- thinking-block-validator
- empty-message-sanitizer
- edit-error-recovery

**恢复稳定**:
- session-recovery
- anthropic-context-window-limit-recovery
- background-compaction

**截断管理**:
- grep-output-truncator
- tool-output-truncator

**通知UX**:
- auto-update-checker
- background-notification
- session-notification
- agent-usage-reminder

**任务管理**:
- task-resume-info
- delegate-task-retry

**集成**:
- claude-code-hooks
- interactive-bash-session
- non-interactive-env

**实现**: Python，事件驱动

### 6.2 Skill系统

**来源**: daoyouCodePilot ✅

**系统级Skills**:
- editblock, wholefile, ask, architect
- udiff, patch, help, search

**项目级Skills**:
- 位置: `skills/`
- 格式: `skill.yaml` + Prompt文件
- 支持Function Calling集成

**用户级Skills**:
- 位置: `~/.daoyoucode/skills/`
- 个人定制

**实现**: Python，YAML配置

### 6.3 插件系统

**来源**: OpenCode + oh-my-opencode 融合 ✅

**插件接口**:
```python
class BasePlugin:
    name: str
    version: str
    
    def initialize(config): pass
    def execute(action, params): pass
    def cleanup(): pass
```

**内置插件**:
- lsp-plugin: LSP集成
- git-plugin: Git操作
- ast-plugin: AST工具
- playwright-plugin: 浏览器自动化

**实现**: Python，动态加载

### 6.4 MCP集成

**来源**: oh-my-opencode ✅

**内置MCPs**:
- websearch: Exa AI网络搜索
- context7: 官方文档查找
- grep_app: GitHub代码搜索

**Skill嵌入MCPs**:
- Skills可以携带自己的MCP服务器

**实现**: Python MCP SDK

### 6.5 Commands系统

**来源**: oh-my-opencode ✅

**内置Commands**:
- `/init-deep`: 初始化AGENTS.md
- `/ralph-loop`: 自引用循环
- `/ulw-loop`: Ultrawork循环
- `/refactor`: 智能重构
- `/start-work`: 从计划开始

**自定义Commands**:
- 项目级: `.daoyoucode/commands/`
- 用户级: `~/.daoyoucode/commands/`

**实现**: Python + Markdown模板

---

## 7. LLM集成

### 7.1 国产模型

**来源**: daoyouCodePilot ✅ 深度优化

**通义千问系列**:
- qwen-max: 最强性能
- qwen-plus: 平衡性能成本
- qwen-turbo: 快速响应
- qwen-coder-plus: 代码专用
- qwen3-coder-plus: 第三代

**DeepSeek系列**:
- deepseek-chat: 通用对话
- deepseek-coder: 代码专用

**实现**: Python SDK直接集成

### 7.2 国际模型

**来源**: oh-my-opencode + OpenCode 融合 ✅

**Claude系列**:
- claude-opus-4-5: 最强推理
- claude-sonnet-4-5: 平衡选择
- claude-haiku-4-5: 快速响应

**GPT系列**:
- gpt-5.2: 高IQ分析
- gpt-4o: 多模态

**Gemini系列**:
- gemini-3-pro: 前端专家
- gemini-3-flash: 快速多模态

**其他**:
- grok-code: 快速探索
- glm-4.7: 免费选择

**实现**: Python + LiteLLM统一接口

### 7.3 本地模型

**来源**: OpenCode ✅

- Ollama集成
- LM Studio集成
- 自定义模型服务器

**实现**: Python + OpenAI兼容API

### 7.4 模型编排

**来源**: oh-my-opencode ✅

- 多模型协作
- 智能路由
- 成本优化
- 并发控制

**实现**: Python，编排引擎

---

## 8. 存储与缓存

### 8.1 历史记录

**来源**: daoyouCodePilot ✅

- Markdown格式持久化
- 自动保存对话
- 历史恢复
- 历史总结
- 历史查询

**位置**: `.daoyoucode.chat.history.md`

**实现**: Python + Markdown

### 8.2 知识库

**来源**: 新增功能 ✅

- Repository Map缓存
- 代码模式缓存
- 代码嵌入缓存
- 团队知识共享

**实现**: Python + SQLite/PostgreSQL

### 8.3 缓存系统

**来源**: daoyouCodePilot ✅

- 文件内容缓存
- LLM响应缓存
- Repository Map缓存
- 智能失效策略

**实现**: Python + Redis (可选)

### 8.4 会话管理

**来源**: oh-my-opencode ✅

**会话工具**:
- session_list: 列出所有会话
- session_read: 读取会话
- session_search: 搜索会话
- session_info: 会话元数据

**实现**: Python + JSONL

---

## 9. 团队协作

### 9.1 配置共享

**来源**: 新增功能 ✅

- 项目级配置: `.daoyoucode/config.yaml`
- 团队级配置: 共享配置仓库
- 用户级配置: `~/.daoyoucode/config.yaml`

**实现**: Python + YAML

### 9.2 知识库共享

**来源**: 新增功能 ✅

- 代码模式共享
- 最佳实践共享
- 历史记录共享
- 团队学习

**实现**: Python + 云存储

### 9.3 协作功能

**来源**: 新增功能 ✅

- 多人同时使用
- 任务分配
- 进度同步
- 结果共享

**实现**: Python + WebSocket

---

## 10. 性能优化

### 10.1 并行执行

**来源**: oh-my-opencode ✅

- 多智能体并行
- 后台任务
- 异步IO
- 并发控制

**实现**: Python asyncio

### 10.2 增量编辑

**来源**: daoyouCodePilot ✅

- 只读取修改部分
- 智能合并编辑
- 缓存优化

**实现**: Python

### 10.3 Token优化

**来源**: oh-my-opencode ✅

- 动态截断
- 智能压缩
- 上下文管理
- 成本估算

**实现**: Python

### 10.4 响应优化

**来源**: 三者融合 ✅

- 流式响应
- 实时反馈
- 进度显示
- 增量更新

**实现**: Python + WebSocket

---

## 11. 特色功能

### 11.1 Ultrawork模式

**来源**: oh-my-opencode ✅ 独特功能

- 关键词触发: `ultrawork` 或 `ulw`
- 极致性能模式
- 并行智能体
- 后台任务
- 激进探索

**实现**: Python，模式切换

### 11.2 Think模式

**来源**: oh-my-opencode ✅

- 自动检测深度思考需求
- 关键词: `think deeply`, `ultrathink`
- 调整模型设置
- 扩展思考预算

**实现**: Python，智能检测

### 11.3 中文优化

**来源**: daoyouCodePilot ✅ 核心优势

- 中文Prompt工程
- 中文指令理解
- 中文错误提示
- 中文文档
- 中文注释理解

**实现**: Python，中文NLP

### 11.4 成本优化

**来源**: 新增功能 ✅

- 智能模型选择
- Token使用统计
- 成本预估
- 预算控制
- 使用报告

**实现**: Python，成本追踪

---

## 12. 质量保证

### 12.1 代码审查

**来源**: daoyouCodePilot ✅

- 自动Linter检查
- 代码风格检查
- 安全检查
- 最佳实践检查

**实现**: Python + Linters

### 12.2 测试集成

**来源**: daoyouCodePilot ✅

- 自动运行测试
- 测试失败修复
- 测试覆盖率
- TDD工作流

**实现**: Python + pytest

### 12.3 注释检查

**来源**: oh-my-opencode ✅

- 提醒减少过多注释
- 智能忽略BDD/docstrings
- 保持代码简洁

**实现**: Python，AST分析

---

## 13. 开发者体验

### 13.1 错误处理

**来源**: 三者融合 ✅

- 友好的错误提示
- 详细的错误日志
- 自动错误恢复
- 错误报告

**实现**: Python，异常处理

### 13.2 日志系统

**来源**: 三者融合 ✅

- 分级日志
- 结构化日志
- 日志轮转
- 日志查询

**实现**: Python logging

### 13.3 调试工具

**来源**: 新增功能 ✅

- 详细模式 (`--verbose`)
- 调试模式 (`--debug`)
- 性能分析
- 请求追踪

**实现**: Python

### 13.4 文档系统

**来源**: 三者融合 ✅

- 中英文文档
- API文档
- 示例代码
- 视频教程
- 最佳实践

**实现**: Markdown + MkDocs

---

## 总结

### 功能统计

| 类别 | 功能数量 | 主要来源 |
|------|---------|---------|
| 核心编辑 | 8种模式 | daoyouCodePilot |
| 智能体 | 13个 | oh-my-opencode + 新增 |
| LSP工具 | 6个 | oh-my-opencode |
| AST工具 | 2个 | oh-my-opencode |
| Git工具 | 10+ | 融合 |
| 文件工具 | 6个 | daoyouCodePilot |
| Hooks | 25+ | oh-my-opencode |
| Skills | 8+ | daoyouCodePilot |
| Commands | 5+ | oh-my-opencode |
| MCPs | 3+ | oh-my-opencode |
| LLM模型 | 15+ | 融合 |
| UI界面 | 4种 | 融合 |

### 技术选型

| 层级 | 技术 | 原因 |
|------|------|------|
| 后端 | Python | 利用daoyou代码，AI库丰富 |
| 前端 | React | 统一UI技术栈 |
| CLI | Python Click | 快速开发 |
| TUI | React Ink | 美观终端UI |
| 桌面 | Electron | 跨平台 |
| API | FastAPI | 高性能异步 |
| 数据库 | SQLite/PostgreSQL | 灵活选择 |
| 缓存 | Redis | 高性能 |
| 通信 | REST + WebSocket | 标准协议 |

### 核心优势

1. **功能最完整**: 融合三个项目所有优点
2. **中文优先**: 深度优化中文体验
3. **模块化**: 每个功能独立模块
4. **可扩展**: 插件/Hook/Skill系统
5. **高性能**: 并行执行，智能缓存
6. **易用性**: 多种UI，开箱即用
7. **成本优化**: 智能模型选择
8. **团队协作**: 配置共享，知识共享

